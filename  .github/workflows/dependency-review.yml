# Project: GuardBSD Winter Saga version 1.0.0
# Package: ci_dependency_review
# Copyright Â© 2025 Cartesian School. Developed by Siergej Sobolewski.
# License: BSD-3-Clause

# .github/workflows/dependency-review.yml
name: Dependency Review

on:
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: read

jobs:
  dependency-review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Dependency Review
        uses: actions/dependency-review-action@v4
        with:
          # Error if a vulnerability of any level (low, moderate, high, critical) is found
          fail-on-severity: low
          
          # Block the addition of dependencies with licenses incompatible with the BSD-3-Clause
          # For example, the GPL (virus license) is prohibited for the BSD kernel.
          deny-licenses: GPL-1.0, GPL-2.0, GPL-3.0, AGPL-1.0, AGPL-3.0
          
          # Permitted Licenses
          allow-licenses: >-
            MIT,
            Apache-2.0,
            BSD-2-Clause,
            BSD-3-Clause,
            CC0-1.0,
            ISC,
            Zlib

      # Additional check: cargo-deny (a more powerful tool)
      - name: Install Rust (for cargo-deny)
        uses: dtolnay/rust-toolchain@stable

      - name: Install cargo-deny
        run: cargo install cargo-deny

      - name: Run cargo-deny check
        # Requires a deny.toml file in the root directory (creating it is recommended)
        # If the file does not exist, this step can be omitted or a default config can be created.
        run: |
          if [ -f deny.toml ]; then
            cargo deny check
          else
            echo "No deny.toml found, skipping extra checks."
          fi
